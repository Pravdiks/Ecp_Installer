# ECP Installer — ТЗ (portable, Windows 10/11 x64)

> **Перед массовым применением протестируйте в своей среде.**  
> **Не является официальным инструментом CryptoPro/удостоверяющих центров.**

## Цель
Portable-приложение (single-file .exe) для быстрой установки ЭЦП с флешки: сканирует выбранные папки/файлы, собирает очередь задач, ставит сертификаты и пишет понятные логи.

## Входные данные (что поддерживаем)
- `*.pfx` / `*.p12` — сертификат + закрытый ключ (импорт в хранилище Windows).
- `*.cer` / `*.crt` + папка контейнера — сценарий CryptoPro (через `certmgr.exe`, если установлен CSP).

Неподдерживаемое (PDF/DOCX/JPG и т.п.) игнорируется.

## Поведение по умолчанию
- Store: `CurrentUser\My` (без админ-прав).
- Пароль к PFX/P12: **по умолчанию пустой** (запоминает ранее устоновленный).
- Ошибка одной задачи **не стопорит** остальные.

## Права и безопасность
- Приложение **не** обходит UAC и не делает скрытую эскалацию.
- При выборе `LocalMachine`:
  - проверка админ-прав,
  - при отсутствии прав — предупреждение + предложение fallback в `CurrentUser\My`.
- Для CryptoPro-сценария: если нет CSP/`certmgr.exe` — показывается диагностическая ошибка.

## Дубликаты/замена сертификатов
- По умолчанию **ничего не удаляем автоматически**.
- Если найдено совпадение/конфликт — задача получает статус `Exists/Conflict` и показывает, что найдено.
- Опция “Заменить”:
  - удаляет совпавшие сертификаты **только после подтверждения пользователя**,
  - затем устанавливает новый.

## UI (3 состояния)
1) **Подготовка**
   - Drag&drop файлов/папок
   - Кнопки: «Выбрать», «Сканировать», «Очистить»
   - Настройки: пароль (пусто), Store (`CurrentUser/LocalMachine`), контейнер (`Диск/Реестр`), Topmost  
2) **Очередь**
   - Таблица: тип, путь сертификата, путь контейнера (если нужен), store, статус, сообщение
   - Прогресс-бар  
3) **Выполнение/аудит**
   - «Установить всё» — последовательная обработка очереди
   - Статусы: `Pending → Running → Success/Error/Skipped/Exists/Conflict`
   - Live-лог + «Открыть лог»
   - Кнопки: «Открыть certmgr» (CurrentUser), «Открыть certlm» (LocalMachine)

## Логирование
- Основной лог: `%LOCALAPPDATA%\EcpInstaller\Logs\EcpInstaller.log`
- В интерфейсе — live-лог
- Дополнительно: дубликат рядом с exe (если доступно для записи)

## Сборка (portable single-file)
Протестированно на Windows (x64) 10, 11, Server 2022

```bash
dotnet restore EcpInstaller.sln
dotnet publish EcpInstaller.App/EcpInstaller.App.csproj -c Release -r win-x64 --self-contained true /p:PublishSingleFile=true
